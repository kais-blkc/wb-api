# üì¶ Tariff Sync Service

–≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–∞—Ä–∏—Ñ—ã —Å WB API –∫–∞–∂–¥—ã–π —á–∞—Å
- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–∞—Ä–∏—Ñ—ã –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–µ Google –¢–∞–±–ª–∏—Ü—ã (–Ω–∞ –ª–∏—Å—Ç `stocks_coefs`)
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞—Ä–∏—Ñ—ã –≤ –±–∞–∑–µ, —É–¥–∞–ª—è—è —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: —ç–∫—Å–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ** –∏–º–ø–æ—Ä—Ç–∞

## ‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Node.js + TypeScript
- Knex.js + PostgreSQL
- Cron (—á–µ—Ä–µ–∑ `node-cron`)
- Google Sheets API

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

1. **–°–æ–∑–¥–∞–π `.env` —Ñ–∞–π–ª** (–∏–ª–∏ `.env.local`) –∏ –ø—Ä–æ–ø–∏—à–∏ –Ω—É–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
DATABASE_URL=postgres://user:password@host:port/dbname
GOOGLE_SHEET_IDS=sheet_id_1,sheet_id_2,...
```

2. **–î–æ–±–∞–≤—å** google-service-account.json –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞:

```bash
your-project/
‚îú‚îÄ‚îÄ google-service-account.json
```

3. **–î–æ–±–∞–≤—å** sheetId –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `SHEET_CONFIGS` –≤`src/core/config/google/google-sheets.config.ts` –∏–ª–∏ –≤ `GOOGLE_SHEET_ID` .env  

```ts
export const SHEET_CONFIGS = [
  {
    sheetId: "your-sheet-id",
    sheetName: "stocks_coefs",
  },
];
```

### –ì–¥–µ –≤–∑—è—Ç—å google-service-account.json?

**–≠—Ç–æ —Ñ–∞–π–ª —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –æ—Ç Google —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Google –¢–∞–±–ª–∏—Ü.**



1. [–ü–µ—Ä–µ–π–¥–∏ –≤ Google Cloud > IAM & ADMIN & Services](https://console.cloud.google.com/iam-admin/serviceaccounts)

2. –°–æ–∑–¥–∞–π –ø—Ä–æ–µ–∫—Ç (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)

4. –ù–∞–∂–º–∏ Create Credentials ‚Üí Service Account

5. –ù–∞–∑–æ–≤–∏ –µ–≥–æ, —Å–æ–∑–¥–∞–π, –Ω–∞ —à–∞–≥–µ "Grant access" –º–æ–∂–Ω–æ –Ω–∞–∂–∞—Ç—å "Done"

6. –í —Å–ø–∏—Å–∫–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –Ω–∞–∂–º–∏ –Ω–∞ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–π ‚Üí –≤–∫–ª–∞–¥–∫–∞ Keys

7. –ù–∞–∂–º–∏ Add Key ‚Üí JSON ‚Äî —Å–∫–∞—á–∞–π google-service-account.json

8. –î–æ–±–∞–≤—å email —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: my-bot@my-project.iam.gserviceaccount.com) –≤ –¥–æ—Å—Ç—É–ø –∫ Google –¢–∞–±–ª–∏—Ü–µ —Å –ø—Ä–∞–≤–∞–º–∏ Editor

## üê≥ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

```bash
docker compose up --build
```

**–≠—Ç–æ:**

- –°–æ–±–µ—Ä—ë—Ç –ø—Ä–æ–µ–∫—Ç
- –ó–∞–ø—É—Å—Ç–∏—Ç –µ–≥–æ —Å nodemon –∏ tsx
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç import ‚Üí export —Ç–∞—Ä–∏—Ñ–æ–≤ –ø–æ cron –∫–∞–∂–¥—ã–π —á–∞—Å

## üõ† –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

- src/app.ts ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- src/crons/ ‚Äî –∑–∞–¥–∞—á–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- src/services/ ‚Äî —Ä–∞–±–æ—Ç–∞ —Å API –∏ Google Sheets
- src/core/utils/googleAuth.ts ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Google API
- src/postgres/ ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –∏ knex

## üìÖ Cron —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ

**–ö–∞–∂–¥—ã–π —á–∞—Å:**

- importTariffsFromApi() ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞—Ä–∏—Ñ—ã –≤ –ë–î
- exportTariffsToSheets() ‚Äî —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏—Ö –≤ Google –¢–∞–±–ª–∏—Ü—ã (–≤ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ)

## ‚úÖ –ü—Ä–∏–º–µ—Ä Google –¢–∞–±–ª–∏—Ü—ã

**–õ–∏—Å—Ç –¥–æ–ª–∂–µ–Ω –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è:**

```text
stocks_coefs
```

–ü–µ—Ä–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞.

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

**–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫—Ä–æ–Ω –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏), –≤ cron.schedule() –ø–æ–º–µ–Ω—è–π:**

(–°–∞–π—á–∞—Å —Å—Ç–æ–∏—Ç 1 –º–∏–Ω—É—Ç–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```ts
cron.schedule("* * * * *", ...)
```
